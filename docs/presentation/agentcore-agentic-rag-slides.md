# Agentic RAG with AgentCore + S3Vector
## ECS ã‹ã‚‰ AgentCore ã¸ï¼šã‚³ã‚¹ãƒˆ50%å‰Šæ¸›ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹3å€é«˜é€ŸåŒ–ã®å®Ÿè·µ

---

# ğŸ“‹ ã‚¢ã‚¸ã‚§ãƒ³ãƒ€

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦** - èª²é¡Œã¨è§£æ±ºç­–
2. **ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** - å…¨ä½“æ§‹æˆ
3. **AgentCore Runtime** - è©³ç´°è¨­è¨ˆ
4. **Clean Architecture** - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…
5. **AgentCore Memory** - ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶
6. **Knowledge Base RAG** - æ¤œç´¢æ‹¡å¼µç”Ÿæˆ
7. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** - Amplify Gen2
8. **æˆæœã¨KPI** - å°å…¥åŠ¹æœ

---

# 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

---

## ğŸ¯ Before: æ—¢å­˜ECSæ§‹æˆã®èª²é¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ—¢å­˜æ§‹æˆ (ECS Fargate)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   ECS       â”‚  â”‚ OpenSearch  â”‚  â”‚   Redis     â”‚    â”‚
â”‚  â”‚   Fargate   â”‚  â”‚ Serverless  â”‚  â”‚   Cluster   â”‚    â”‚
â”‚  â”‚   (å¸¸æ™‚ç¨¼åƒ) â”‚  â”‚ (Vector)    â”‚  â”‚   (Memory)  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  èª²é¡Œ:                                                   â”‚
â”‚  âŒ æœˆé¡ã‚³ã‚¹ãƒˆ: é«˜é¡ (å¸¸æ™‚ç¨¼åƒ)                          â”‚
â”‚  âŒ ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ: 3-5ç§’                              â”‚
â”‚  âŒ é‹ç”¨è² è·: 3ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç®¡ç†                       â”‚
â”‚  âŒ ãƒ¡ãƒ¢ãƒªç®¡ç†: è‡ªå‰å®Ÿè£…ãŒå¿…è¦                           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… After: AgentCore æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ–°æ§‹æˆ (AgentCore)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           AgentCore Runtime (ECR)               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  Python Agent + Strands + Clean Arch     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                 â”‚    â”‚
â”‚  â”‚  + AgentCore Memory (Short/Episodic/Semantic)  â”‚    â”‚
â”‚  â”‚  + S3 Vector (Knowledge Base)                  â”‚    â”‚
â”‚  â”‚  + Cognito (Identity)                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  æ”¹å–„:                                                   â”‚
â”‚  âœ… ã‚³ã‚¹ãƒˆ: -52% (å¾“é‡èª²é‡‘ + ã‚¹ã‚±ãƒ¼ãƒ«ã‚¼ãƒ­)               â”‚
â”‚  âœ… ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ: <0.5ç§’                             â”‚
â”‚  âœ… é‹ç”¨: ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹æ´»ç”¨                         â”‚
â”‚  âœ… ãƒ¡ãƒ¢ãƒª: AgentCore Memory çµ±åˆ                       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ”¹å–„åŠ¹æœã‚µãƒãƒªãƒ¼

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | Before (ECS) | After (AgentCore) | æ”¹å–„ç‡ |
|-----------|--------------|-------------------|--------|
| **æœˆé¡ã‚³ã‚¹ãƒˆ** | $XXX | $XXX | **-52%** |
| **å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹** | 2.3ç§’ | 0.8ç§’ | **3.8å€é«˜é€Ÿ** |
| **ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ** | 3-5ç§’ | <0.5ç§’ | **6-10å€é«˜é€Ÿ** |
| **é‹ç”¨å·¥æ•°** | 100% | 40% | **-60%** |

---

# 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

---

## ğŸ—ï¸ å…¨ä½“æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AWS Cloud                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Frontend (Amplify Gen2)                        â”‚  â”‚
â”‚  â”‚  Next.js 15 â†’ Static Export â†’ CloudFront CDN                   â”‚  â”‚
â”‚  â”‚  - Cognitoèªè¨¼                                                  â”‚  â”‚
â”‚  â”‚  - SSE/WebSocket Streamingå¯¾å¿œ                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                    â”‚
â”‚                                  â”‚ ç›´æ¥æ¥ç¶šï¼ˆSSE/WebSocketï¼‰          â”‚
â”‚                                  â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  AgentCore Runtime (ECR)                        â”‚  â”‚
â”‚  â”‚  Python Agent (Strands Agents + Clean Architecture)            â”‚  â”‚
â”‚  â”‚  - ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢ï¼ˆmicroVMï¼‰                                    â”‚  â”‚
â”‚  â”‚  - åŒæ–¹å‘ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°                                         â”‚  â”‚
â”‚  â”‚  - æœ€å¤§8æ™‚é–“å®Ÿè¡Œ                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                    â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚        â–¼                         â–¼                         â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚AgentCore      â”‚    â”‚ AgentCore Memory  â”‚    â”‚ AgentCore         â”‚ â”‚
â”‚  â”‚Identity       â”‚    â”‚ - Short-term      â”‚    â”‚ Observability     â”‚ â”‚
â”‚  â”‚- Cognitoé€£æº  â”‚    â”‚ - Episodic (NEW)  â”‚    â”‚ - CloudWatch      â”‚ â”‚
â”‚  â”‚- Token Vault  â”‚    â”‚ - Semantic        â”‚    â”‚ - X-Ray           â”‚ â”‚
â”‚  â”‚               â”‚    â”‚ - Reflections     â”‚    â”‚                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚                                    â”‚
â”‚                                  â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       Tool Layer                                â”‚  â”‚
â”‚  â”‚  Lambda Functions | S3 Vector (Knowledge Base) | DynamoDB      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ AgentCore Runtime ç›´æ¥æ¥ç¶š

**ãªãœ Gateway ã‚’ä½¿ã‚ãªã„ã®ã‹ï¼Ÿ**

| è¦³ç‚¹ | GatewayçµŒç”± | Runtimeç›´æ¥æ¥ç¶š âœ… |
|------|-------------|-------------------|
| **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°** | äºŒæ®µæ§‹æˆ | ç›´æ¥SSE/WebSocket |
| **ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·** | ä¸­ç¶™ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ | æœ€å° |
| **æ§‹æˆã®è¤‡é›‘ã•** | Gatewayè¨­å®šå¿…è¦ | ã‚·ãƒ³ãƒ—ãƒ« |
| **Toolç®¡ç†** | Gatewayå´ã§MCPåŒ– | Runtimeå†…ã§Strandså®šç¾© |

**é¸å®šç†ç”±:**
- ã‚·ãƒ³ãƒ—ãƒ«ãªRAGãƒãƒ£ãƒƒãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ
- åŒæ–¹å‘ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç›´æ¥ã‚µãƒãƒ¼ãƒˆ
- Tools ã¯ `@tool` ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã§å®šç¾©

---

# 3. AgentCore Runtime

---

## âš™ï¸ AgentCore Runtime ã®ç‰¹å¾´

| é …ç›® | å€¤ |
|------|-----|
| **Base Image** | python:3.11-slim (ECR) |
| **Framework** | Strands Agents |
| **SDK** | bedrock-agentcore-sdk-python |
| **Model** | apac.amazon.nova-pro-v1:0 |
| **Max Execution Time** | 8æ™‚é–“ |
| **Max Payload** | 100MB |
| **Streaming** | SSE + WebSocket (åŒæ–¹å‘) |
| **Session Isolation** | microVM (å®Œå…¨åˆ†é›¢) |
| **Scaling** | ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ (ã‚¹ã‚±ãƒ¼ãƒ«ã‚¼ãƒ­å¯¾å¿œ) |

---

## ğŸ“ AgentCore Entrypoint å®Ÿè£…

```python
# agent.py - AgentCore Runtime ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ

from bedrock_agentcore import BedrockAgentCoreApp
from strands import Agent

app = BedrockAgentCoreApp()

# Knowledge Base ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
kb_client = KnowledgeBaseClient(
    knowledge_base_id=KNOWLEDGE_BASE_ID,
    region=REGION,
)

@app.entrypoint
def invoke(payload: dict) -> dict:
    """AgentCore Runtime ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ"""
    prompt = payload.get("prompt", "")
    session_id = payload.get("session_id", "default-session")
    
    # 1. RAG: Knowledge Base ã‹ã‚‰é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—
    rag_chunks = kb_client.retrieve(query=prompt, top_k=5)
    rag_context = build_rag_context(rag_chunks)
    
    # 2. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆ (RAGã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ³¨å…¥)
    agent = Agent(
        model=MODEL_ID,
        system_prompt=f"{BASE_SYSTEM_PROMPT}\n\n{rag_context}",
    )
    
    # 3. å®Ÿè¡Œ
    result = agent(prompt)
    
    return {
        "response": result.message,
        "sources": rag_chunks,
        "session_id": session_id,
    }

if __name__ == "__main__":
    app.run()
```

---

## ğŸ› ï¸ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

```bash
# 1. åˆæœŸè¨­å®š
agentcore configure --entrypoint agent.py

# 2. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
agentcore launch --local
agentcore invoke --local '{"prompt": "Hello"}'

# 3. ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤
agentcore launch

# 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªãƒ»å‘¼ã³å‡ºã—
agentcore status
agentcore invoke '{"prompt": "è£½å“ã®è¿”å“æ–¹æ³•ã‚’æ•™ãˆã¦ãã ã•ã„"}'
```

---

# 4. Clean Architecture

---

## ğŸ§… ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                        â”‚
â”‚  AgentCore Entrypoint | Strands @tool | Streaming Handlers  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Application Layer                         â”‚
â”‚  Commands | Queries | Event Handlers (CQRS)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Domain Layer                            â”‚
â”‚  Entities | Value Objects | Domain Services | Domain Events â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Infrastructure Layer                       â”‚
â”‚  AgentCore Memory | S3Vector | Event Store | External APIs  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
backend/
â”œâ”€â”€ agent.py                      # AgentCore Entrypoint
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/                   # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/         # Agent, AgentSession
â”‚   â”‚   â”‚   â”œâ”€â”€ value_objects/    # AgentId, Prompt, Response
â”‚   â”‚   â”‚   â”œâ”€â”€ events/           # AgentInvoked, ResponseGenerated
â”‚   â”‚   â”‚   â””â”€â”€ repositories/     # ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â””â”€â”€ shared/               # Entity, ValueObject åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ application/              # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”‚   â”œâ”€â”€ commands/             # SubmitQuestion, UploadDocument
â”‚   â”‚   â”œâ”€â”€ queries/              # GetConversation, SearchDocuments
â”‚   â”‚   â””â”€â”€ services/             # PatternApplicator
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/           # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
â”‚   â”‚   â”œâ”€â”€ agentcore/            # Memory Client, Episodic, Reflection
â”‚   â”‚   â”œâ”€â”€ external_services/    # S3Vector, Bedrock
â”‚   â”‚   â””â”€â”€ config/               # DI Container, Settings
â”‚   â”‚
â”‚   â””â”€â”€ presentation/             # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚       â”œâ”€â”€ entrypoint/           # AgentFactory, Prompts
â”‚       â””â”€â”€ tools/                # KnowledgeTool
```

---

## ğŸ”„ CQRS ãƒ‘ã‚¿ãƒ¼ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CQRS Architecture                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚   Command     â”‚                       â”‚    Query      â”‚    â”‚
â”‚   â”‚   (Write)     â”‚                       â”‚    (Read)     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                       â”‚             â”‚
â”‚           â–¼                                       â–¼             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚SubmitQuestion â”‚                       â”‚GetConversationâ”‚    â”‚
â”‚   â”‚   Handler     â”‚                       â”‚   Handler     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                       â”‚             â”‚
â”‚           â–¼                                       â–¼             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      Events       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ Event Store   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Read Model    â”‚        â”‚
â”‚   â”‚ (DynamoDB)    â”‚    Projection    â”‚ (DynamoDB)    â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚   AgentCore Memory: ä¼šè©±å±¥æ­´ã¯ AgentCore Memory ã§ç®¡ç†          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ Agent Factory å®Ÿè£…

```python
# presentation/entrypoint/agent_factory.py

class StrandsAgentWrapper:
    """RAG + Episodic Memory çµ±åˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""
    
    async def invoke(self, prompt: str, session_id: str, user_id: str):
        # 1. RAG: Knowledge Base ã‹ã‚‰æ¤œç´¢
        rag_chunks = await self._s3vector_client.search(query=prompt)
        rag_context = self._build_rag_context(rag_chunks)
        
        # 2. Episodic Memory: é¡ä¼¼ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ¤œç´¢
        episodes = await self._episodic_service.retrieve_similar_episodes(
            user_id=user_id, query=prompt
        )
        episodic_context = self._episodic_service.build_episode_context(episodes)
        
        # 3. Reflections: æ´å¯Ÿæ¤œç´¢
        reflections = await self._reflection_service.retrieve_relevant_reflections(
            user_id=user_id, use_case=prompt
        )
        
        # 4. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œ (ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆ)
        enriched_prompt = build_system_prompt(
            rag_context=rag_context,
            episodic_context=episodic_context,
            reflection_context=reflections,
        )
        response = await self._agent.invoke(prompt, system_prompt=enriched_prompt)
        
        # 5. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ä¿å­˜ (ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ¤œå‡ºç”¨)
        await self._episodic_service.save_interaction(
            session_id=session_id,
            user_id=user_id,
            user_message=prompt,
            assistant_response=response,
        )
        
        return response
```

---

# 5. AgentCore Memory

---

## ğŸ§  Memory Strategy æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AgentCore Memory Strategies                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               Short-term Memory (ã‚»ãƒƒã‚·ãƒ§ãƒ³)               â”‚ â”‚
â”‚  â”‚   ç”¨é€”: ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ä¼šè©±å±¥æ­´                              â”‚ â”‚
â”‚  â”‚   ä¿æŒæœŸé–“: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               Semantic Memory (äº‹å®Ÿ)                       â”‚ â”‚
â”‚  â”‚   ç”¨é€”: é™çš„ãªäº‹å®Ÿãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼å±æ€§ã®æ°¸ç¶šåŒ–                    â”‚ â”‚
â”‚  â”‚   ä¿æŒæœŸé–“: æ°¸ç¶š                                            â”‚ â”‚
â”‚  â”‚   æ¤œç´¢: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            ã€NEWã€‘Episodic Memory (ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶)          â”‚ â”‚
â”‚  â”‚   ç”¨é€”: éå»ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€Œä½“é¨“ã€ã‚’å­¦ç¿’            â”‚ â”‚
â”‚  â”‚   æ§‹æˆ: Situation, Intent, Assessment, Justification       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚            ã€NEWã€‘Reflections (æ´å¯Ÿãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡º)          â”‚ â”‚
â”‚  â”‚   ç”¨é€”: è¤‡æ•°ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æŠ½å‡º  â”‚ â”‚
â”‚  â”‚   æ´»ç”¨: éå»ã®å¤±æ•—ã‚’ç¹°ã‚Šè¿”ã•ãªã„ã€æˆåŠŸæˆ¦ç•¥ã‚’é©ç”¨            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š Episodic Memory ã®æ§‹é€ 

```python
@dataclass
class Episode:
    """ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ """
    id: str
    situation: str      # ä½•ãŒèµ·ããŸã‹
    intent: str         # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³
    assessment: str     # æˆåŠŸ/å¤±æ•—ã®è©•ä¾¡
    justification: str  # ç†ç”±
    reflection: str     # ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®æ´å¯Ÿ
    tools_used: list    # ä½¿ç”¨ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«
    timestamp: str
```

**æ´»ç”¨ä¾‹:**
- ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ â†’ ä»£æ›¿ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§è§£æ±ºã—ãŸä½“é¨“
- äºˆç´„å¤‰æ›´ã‚¿ã‚¹ã‚¯ã§Toolé¸æŠ â†’ æˆåŠŸã—ãŸä½“é¨“
- ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã§æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç™ºè¦‹ã—ãŸä½“é¨“

---

## ğŸ”§ Memory Client å®Ÿè£…

```python
# infrastructure/agentcore/memory_client.py

class AgentCoreMemoryClient:
    """AgentCore Memory API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""
    
    async def create_memory_store(self, name: str) -> str:
        """Memory Store ä½œæˆ (Episodic Strategyå«ã‚€)"""
        response = self._client.create_memory(
            name=name,
            memoryStrategies=[
                {"semanticMemoryStrategy": {...}},
                {"episodicMemoryStrategy": {
                    "namespaces": {
                        "episodes": "/episodes/{actorId}",
                        "reflections": "/reflections/{actorId}",
                    }
                }},
            ],
        )
        return response.get("memoryId")
    
    async def create_event(self, actor_id: str, session_id: str, messages: list):
        """ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ä¿å­˜ (ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è‡ªå‹•æ¤œå‡º)"""
        # create_event å®Ÿè¡Œæ™‚ã«è‡ªå‹•çš„ã«:
        # 1. ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰å®Œäº†ã‚’æ¤œå‡º
        # 2. ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’æ§‹é€ åŒ–ã—ã¦ä¿å­˜
        # 3. Reflections ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç”Ÿæˆ
        self._client.create_memory_event(
            memoryId=self._memory_id,
            actorId=actor_id,
            sessionId=session_id,
            messages=messages,
        )
    
    async def retrieve_memories(self, namespace: str, query: str) -> list:
        """ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã§ãƒ¡ãƒ¢ãƒªå–å¾—"""
        return self._client.retrieve_memories(
            memoryId=self._memory_id,
            namespace=namespace,
            query=query,
        )
```

---

# 6. Knowledge Base RAG

---

## ğŸ“– RAG å®Ÿè£…ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RAG Flow                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   User Query: "è¿”å“ãƒãƒªã‚·ãƒ¼ã«ã¤ã„ã¦æ•™ãˆã¦"                      â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  1. Knowledge Base æ¤œç´¢ (S3 Vector)                       â”‚ â”‚
â”‚   â”‚     - ã‚¯ã‚¨ãƒªã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–                                   â”‚ â”‚
â”‚   â”‚     - é¡ä¼¼åº¦æ¤œç´¢ (top_k=5, score_threshold=0.5)           â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  2. RAG ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰                                   â”‚ â”‚
â”‚   â”‚     - é–¢é€£ãƒãƒ£ãƒ³ã‚¯æŠ½å‡º                                     â”‚ â”‚
â”‚   â”‚     - ã‚½ãƒ¼ã‚¹æƒ…å ±ä»˜ä¸                                       â”‚ â”‚
â”‚   â”‚     - ã‚¹ã‚³ã‚¢ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°                               â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  3. ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æ³¨å…¥                               â”‚ â”‚
â”‚   â”‚     BASE_PROMPT + RAG_CONTEXT + EPISODIC_CONTEXT          â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  4. LLM å®Ÿè¡Œ (Nova Pro)                                   â”‚ â”‚
â”‚   â”‚     - å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«åŸºã¥ã„ã¦å›ç­”ç”Ÿæˆ                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚   Response + Sources (å¼•ç”¨å…ƒ)                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Knowledge Base æ¤œç´¢å®Ÿè£…

```python
# agent.py

class KnowledgeBaseClient:
    """Bedrock Knowledge Base retrieval ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""
    
    def __init__(self, knowledge_base_id: str, region: str):
        self._client = boto3.client("bedrock-agent-runtime", region_name=region)
        self._knowledge_base_id = knowledge_base_id
    
    def retrieve(self, query: str, top_k: int = 5, score_threshold: float = 0.5):
        """é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢"""
        response = self._client.retrieve(
            knowledgeBaseId=self._knowledge_base_id,
            retrievalQuery={"text": query},
            retrievalConfiguration={
                "vectorSearchConfiguration": {"numberOfResults": top_k}
            },
        )
        
        results = []
        for item in response.get("retrievalResults", []):
            score = item.get("score", 0)
            if score < score_threshold:
                continue
            
            results.append({
                "content": item.get("content", {}).get("text", ""),
                "score": score,
                "source": item.get("location", {}).get("s3Location", {}).get("uri", ""),
            })
        
        return results


def build_rag_context(chunks: list) -> str:
    """RAGã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ§‹ç¯‰"""
    context_parts = ["## å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\n"]
    for i, chunk in enumerate(chunks[:5], 1):
        context_parts.append(f"### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ {i} (é–¢é€£åº¦: {chunk['score']:.2f})")
        context_parts.append(f"```\n{chunk['content'][:800]}\n```\n")
    return "\n".join(context_parts)
```

---

# 7. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

---

## ğŸ’» Amplify Gen2 æ§‹æˆ

```
frontend/
â”œâ”€â”€ amplify/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ resource.ts          # Cognito User Pool å®šç¾©
â”‚   â””â”€â”€ backend.ts               # Backend çµ±åˆå®šç¾©
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                     # Next.js App Router
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â””â”€â”€ chat/
â”‚   â”‚       â”œâ”€â”€ api/
â”‚   â”‚       â”‚   â””â”€â”€ agentcore-client.ts   # AgentCore ç›´æ¥å‘¼ã³å‡ºã—
â”‚   â”‚       â”œâ”€â”€ hooks/
â”‚   â”‚       â”‚   â””â”€â”€ use-chat-stream.ts
â”‚   â”‚       â””â”€â”€ ui/
â”‚   â”‚           â””â”€â”€ chat-container.tsx
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ message/
â”‚   â””â”€â”€ shared/
â”‚       â””â”€â”€ lib/
â”‚           â””â”€â”€ amplify-config.ts
â”œâ”€â”€ amplify.yml                  # Amplify build settings
â””â”€â”€ package.json
```

---

## ğŸ”Œ AgentCore Client (TypeScript)

```typescript
// features/chat/api/agentcore-client.ts

export class AgentCoreClient {
  /**
   * AgentCore ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° invoke
   */
  async *stream(params: InvokeParams): AsyncGenerator<StreamChunk> {
    const client = await this.getClient();  // Cognito èªè¨¼
    
    const command = new InvokeAgentRuntimeCommand({
      agentRuntimeArn: this.config.agentRuntimeArn,
      qualifier: this.config.agentEndpointName,
      runtimeSessionId: params.sessionId,
      payload: new TextEncoder().encode(JSON.stringify({
        prompt: params.prompt,
        sessionId: params.sessionId,
        userId: params.userId,
      })),
    });

    const response = await client.send(command);
    
    // WebStream ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†
    const webStream = response.response.transformToWebStream();
    const reader = webStream.getReader();
    
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      
      const text = extractTextFromResponse(JSON.parse(decoder.decode(value)));
      yield { type: 'text', content: text };
    }
    
    yield { type: 'end', latencyMs: Date.now() - startTime };
  }
}
```

---

## ğŸ¨ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### Backend
| æŠ€è¡“ | ç”¨é€” |
|------|------|
| Python 3.11 | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  |
| **Strands Agents** | Agent Framework |
| **bedrock-agentcore-sdk** | AgentCore SDK |
| Pydantic 2.x | Validation |
| Structlog | Structured Logging |
| Boto3 / Aioboto3 | AWS SDK |

### Frontend
| æŠ€è¡“ | ç”¨é€” |
|------|------|
| Next.js 15 | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| React 19 | UI |
| TypeScript 5.6 | è¨€èª |
| **AWS Amplify Gen2** | Hosting + Auth |
| TanStack Query | ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ |
| Zustand | State Management |
| Tailwind CSS | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |

---

# 8. æˆæœã¨KPI

---

## ğŸ“ˆ å°å…¥åŠ¹æœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å°å…¥åŠ¹æœã‚µãƒãƒªãƒ¼                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ğŸ’° ã‚³ã‚¹ãƒˆå‰Šæ¸›                                                 â”‚
â”‚   â”œâ”€ å¾“é‡èª²é‡‘ãƒ¢ãƒ‡ãƒ«ã¸ç§»è¡Œ                                       â”‚
â”‚   â”œâ”€ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¼ãƒ­å¯¾å¿œ                                           â”‚
â”‚   â””â”€ ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ã‚³ã‚¹ãƒˆå‰Šæ¸›                                     â”‚
â”‚       â†’ æœˆé¡ã‚³ã‚¹ãƒˆ 52% å‰Šæ¸›                                     â”‚
â”‚                                                                 â”‚
â”‚   âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š                                         â”‚
â”‚   â”œâ”€ ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ: 3-5ç§’ â†’ <0.5ç§’                          â”‚
â”‚   â””â”€ å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 2.3ç§’ â†’ 0.8ç§’                             â”‚
â”‚       â†’ 3.8å€é«˜é€ŸåŒ–                                             â”‚
â”‚                                                                 â”‚
â”‚   ğŸ› ï¸ é‹ç”¨åŠ¹ç‡åŒ–                                                 â”‚
â”‚   â”œâ”€ ãƒ¡ãƒ¢ãƒªç®¡ç†ã®è‡ªå‹•åŒ– (AgentCore Memory)                      â”‚
â”‚   â”œâ”€ èªè¨¼åŸºç›¤ã®çµ±åˆ (AgentCore Identity)                        â”‚
â”‚   â””â”€ å¯è¦³æ¸¬æ€§ã®çµ„ã¿è¾¼ã¿ (CloudWatch/X-Ray)                      â”‚
â”‚       â†’ é‹ç”¨å·¥æ•° 60% å‰Šæ¸›                                       â”‚
â”‚                                                                 â”‚
â”‚   ğŸ§  æ©Ÿèƒ½æ‹¡å¼µ                                                   â”‚
â”‚   â”œâ”€ ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶: éå»ã®ä½“é¨“ã‹ã‚‰å­¦ç¿’                         â”‚
â”‚   â”œâ”€ Reflections: ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æŠ½å‡º              â”‚
â”‚   â””â”€ RAG: Knowledge Base ã«ã‚ˆã‚‹å›ç­”å“è³ªå‘ä¸Š                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ KPI (ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶)

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• |
|-----|-------|---------|
| ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ¤œå‡ºç‡ | > 80% | å®Œäº†ã‚¿ã‚¹ã‚¯ã«å¯¾ã™ã‚‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ç”Ÿæˆæ•° |
| é¡ä¼¼ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ´»ç”¨ç‡ | > 60% | ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãŒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã¾ã‚ŒãŸå¿œç­”ã®å‰²åˆ |
| Reflection ç”Ÿæˆæ•° | > 10/é€± | é€±æ¬¡ã®Reflectionç”Ÿæˆæ•° |
| å¿œç­”å“è³ªå‘ä¸Š | +15% | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¹ã‚³ã‚¢ |
| åŒä¸€ã‚¨ãƒ©ãƒ¼å†ç™ºç‡ | -30% | éå»ã«å¤±æ•—ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®å†ç™ºç‡ |

---

## ğŸ“š ä¸»è¦æ©Ÿèƒ½

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| **Agentic RAG** | Knowledge Base æ¤œç´¢ + ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä»˜ä¸å›ç­” |
| **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”** | SSE/WebSocket ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ |
| **ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶** | éå»ã®ä½“é¨“ã‹ã‚‰å­¦ç¿’ã€æ„æ€æ±ºå®šæ”¹å–„ |
| **Reflections** | ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æŠ½å‡º |
| **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ** | Cognito + AgentCore Identity ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ |
| **CQRS** | ã‚³ãƒãƒ³ãƒ‰ã¨ã‚¯ã‚¨ãƒªã®åˆ†é›¢ |
| **ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°** | DynamoDB Event Store |

---

# ğŸ”— å‚è€ƒè³‡æ–™

- [Amazon Bedrock AgentCore Documentation](https://docs.aws.amazon.com/bedrock-agentcore/)
- [AgentCore SDK (Python)](https://github.com/aws/bedrock-agentcore-sdk-python)
- [AgentCore Samples](https://github.com/awslabs/amazon-bedrock-agentcore-samples/)
- [AgentCore Memory - Episodic Strategy](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/episodic-memory-strategy.html)
- [Strands Agents](https://strandsagents.com/)
- [AWS Amplify Gen2](https://docs.amplify.aws/gen2/)
- [Feature-Sliced Design](https://feature-sliced.design/)

---

# ğŸ™ ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ

## Q&A

**ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆ:**
```
ai-agent-core-microservice-prot/
â”œâ”€â”€ backend/         # Python Agent (AgentCore Runtime)
â”œâ”€â”€ frontend/        # Next.js (Amplify Gen2)
â”œâ”€â”€ infrastructure/  # AWS CDK
â”œâ”€â”€ 00-requirements/ # RDRAè¦ä»¶å®šç¾©
â”œâ”€â”€ 01-domain-design/# DDD + Event Storming
â””â”€â”€ 02-architecture/ # Clean Architecture + ADR
```




