# ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒ¼ãƒŸãƒ³ã‚°

## 1. Big Picture ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒ¼ãƒŸãƒ³ã‚°

```
Timeline â†’
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ðŸŸ§        â”‚   â”‚   ðŸŸ§        â”‚   â”‚   ðŸŸ§        â”‚   â”‚   ðŸŸ§        â”‚
â”‚ User        â”‚   â”‚ Question    â”‚   â”‚ Search      â”‚   â”‚ Response    â”‚
â”‚ Logged In   â”‚â”€â”€>â”‚ Submitted   â”‚â”€â”€>â”‚ Executed    â”‚â”€â”€>â”‚ Generated   â”‚
â”‚             â”‚   â”‚             â”‚   â”‚             â”‚   â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                 â”‚                 â”‚
                        â–¼                 â–¼                 â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   ðŸŸ¦        â”‚   â”‚   ðŸŸ¦        â”‚   â”‚   ðŸŸ¦        â”‚
                  â”‚ Agent       â”‚   â”‚ S3Vector    â”‚   â”‚ Bedrock     â”‚
                  â”‚ Core        â”‚   â”‚             â”‚   â”‚             â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ãƒ—ãƒ­ã‚»ã‚¹ãƒ¬ãƒ™ãƒ« ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒ¼ãƒŸãƒ³ã‚°

### 2.1 è³ªå•å¿œç­”ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è³ªå•å¿œç­”ãƒ•ãƒ­ãƒ¼                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ðŸŸ¨ Command         ðŸŸ§ Event           ðŸŸª Policy          ðŸŸ¦ Actor/System   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Submit      â”‚â”€â”€>â”‚ Question    â”‚                      â”‚ User        â”‚    â”‚
â”‚  â”‚ Question    â”‚   â”‚ Submitted   â”‚                      â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                    â”‚ ðŸŸª          â”‚                                          â”‚
â”‚                    â”‚ When Question                                          â”‚
â”‚                    â”‚ Submitted,  â”‚                                          â”‚
â”‚                    â”‚ Search KB   â”‚                                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Search      â”‚â”€â”€>â”‚ Search      â”‚                      â”‚ S3Vector    â”‚    â”‚
â”‚  â”‚ Knowledge   â”‚   â”‚ Executed    â”‚                      â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                          â–¼                      â–¼                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚ ðŸŸ§          â”‚        â”‚ ðŸŸ§          â”‚                   â”‚
â”‚                    â”‚ Results     â”‚        â”‚ No Results  â”‚                   â”‚
â”‚                    â”‚ Found       â”‚        â”‚ Found       â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                          â”‚                      â”‚                           â”‚
â”‚                          â–¼                      â–¼                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚ ðŸŸª          â”‚        â”‚ ðŸŸª          â”‚                   â”‚
â”‚                    â”‚ Assemble    â”‚        â”‚ Use General â”‚                   â”‚
â”‚                    â”‚ Context     â”‚        â”‚ Knowledge   â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                          â”‚                      â”‚                           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Generate    â”‚â”€â”€>â”‚ Response    â”‚                      â”‚ Bedrock     â”‚    â”‚
â”‚  â”‚ Response    â”‚   â”‚ Generated   â”‚                      â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                    â”‚ ðŸŸª          â”‚                                          â”‚
â”‚                    â”‚ Store in    â”‚                                          â”‚
â”‚                    â”‚ Conversationâ”‚                                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Save        â”‚â”€â”€>â”‚ Message     â”‚                      â”‚ Memory      â”‚    â”‚
â”‚  â”‚ Message     â”‚   â”‚ Saved       â”‚                      â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç™»éŒ²ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç™»éŒ²ãƒ•ãƒ­ãƒ¼                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Upload      â”‚â”€â”€>â”‚ Document    â”‚                      â”‚ Admin       â”‚    â”‚
â”‚  â”‚ Document    â”‚   â”‚ Uploaded    â”‚                      â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                    â”‚ ðŸŸª          â”‚                                          â”‚
â”‚                    â”‚ When Upload,â”‚                                          â”‚
â”‚                    â”‚ Start       â”‚                                          â”‚
â”‚                    â”‚ Processing  â”‚                                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Chunk       â”‚â”€â”€>â”‚ Document    â”‚                      â”‚ Chunking    â”‚    â”‚
â”‚  â”‚ Document    â”‚   â”‚ Chunked     â”‚                      â”‚ Service     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                    â”‚ ðŸŸª          â”‚                                          â”‚
â”‚                    â”‚ For Each    â”‚                                          â”‚
â”‚                    â”‚ Chunk,      â”‚                                          â”‚
â”‚                    â”‚ Generate    â”‚                                          â”‚
â”‚                    â”‚ Embedding   â”‚                                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Generate    â”‚â”€â”€>â”‚ Embedding   â”‚                      â”‚ Bedrock     â”‚    â”‚
â”‚  â”‚ Embedding   â”‚   â”‚ Generated   â”‚                      â”‚ Embedding   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ðŸŸ¨          â”‚   â”‚ ðŸŸ§          â”‚                      â”‚ ðŸŸ¦          â”‚    â”‚
â”‚  â”‚ Index       â”‚â”€â”€>â”‚ Index       â”‚                      â”‚ S3Vector    â”‚    â”‚
â”‚  â”‚ Chunk       â”‚   â”‚ Updated     â”‚                      â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                   â”‚
â”‚                          â–¼                                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚                    â”‚ ðŸŸ§          â”‚                                          â”‚
â”‚                    â”‚ Document    â”‚                                          â”‚
â”‚                    â”‚ Ready       â”‚                                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§

### 3.1 Agent Context ã‚¤ãƒ™ãƒ³ãƒˆ

| ã‚¤ãƒ™ãƒ³ãƒˆ | ãƒˆãƒªã‚¬ãƒ¼ | çµæžœ |
|---------|---------|------|
| `SessionStarted` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¼šè©±ã‚’é–‹å§‹ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ |
| `QuestionSubmitted` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè³ªå•ã‚’é€ä¿¡ | å‡¦ç†é–‹å§‹ |
| `AgentInvoked` | è³ªå•ãŒå‡¦ç†ã•ã‚Œã‚‹ | LLMå‘¼ã³å‡ºã— |
| `ResponseGenerated` | LLMãŒå›žç­”ã‚’ç”Ÿæˆ | å›žç­”é…ä¿¡ |
| `ResponseStreamed` | ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é€ä¿¡ | UIæ›´æ–° |
| `SessionEnded` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¼šè©±ã‚’çµ‚äº† | ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº† |

### 3.2 RAG Context ã‚¤ãƒ™ãƒ³ãƒˆ

| ã‚¤ãƒ™ãƒ³ãƒˆ | ãƒˆãƒªã‚¬ãƒ¼ | çµæžœ |
|---------|---------|------|
| `SearchExecuted` | è³ªå•ãŒãƒ™ã‚¯ãƒˆãƒ«åŒ–ã•ã‚Œã‚‹ | æ¤œç´¢å®Ÿè¡Œ |
| `ResultsFound` | é¡žä¼¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç™ºè¦‹ | ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰ |
| `NoResultsFound` | é¡žä¼¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãªã— | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| `ContextAssembled` | æ¤œç´¢çµæžœæ•´å½¢ | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ‹¡å¼µ |
| `RerankingCompleted` | å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°å®Œäº† | æœ€çµ‚çµæžœ |

### 3.3 Knowledge Context ã‚¤ãƒ™ãƒ³ãƒˆ

| ã‚¤ãƒ™ãƒ³ãƒˆ | ãƒˆãƒªã‚¬ãƒ¼ | çµæžœ |
|---------|---------|------|
| `DocumentUploaded` | ç®¡ç†è€…ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | å‡¦ç†é–‹å§‹ |
| `DocumentValidated` | ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å®Œäº† | ãƒãƒ£ãƒ³ã‚¯é–‹å§‹ |
| `DocumentChunked` | ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²å®Œäº† | åŸ‹ã‚è¾¼ã¿é–‹å§‹ |
| `EmbeddingGenerated` | åŸ‹ã‚è¾¼ã¿ç”Ÿæˆå®Œäº† | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é–‹å§‹ |
| `IndexUpdated` | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ›´æ–°å®Œäº† | æ¤œç´¢å¯èƒ½ |
| `DocumentDeleted` | ç®¡ç†è€…ãŒå‰Šé™¤ | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‰Šé™¤ |

### 3.4 Conversation Context ã‚¤ãƒ™ãƒ³ãƒˆ

| ã‚¤ãƒ™ãƒ³ãƒˆ | ãƒˆãƒªã‚¬ãƒ¼ | çµæžœ |
|---------|---------|------|
| `ConversationCreated` | æ–°è¦ä¼šè©±é–‹å§‹ | ä¼šè©±ä½œæˆ |
| `MessageAdded` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ | å±¥æ­´æ›´æ–° |
| `ConversationArchived` | ä¸€å®šæœŸé–“çµŒéŽ | ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– |

## 4. é›†ç´„ã¨ã‚³ãƒžãƒ³ãƒ‰

```mermaid
graph LR
    subgraph Commands
        C1[SubmitQuestion]
        C2[UploadDocument]
        C3[StartSession]
        C4[EndSession]
    end
    
    subgraph Aggregates
        A1[Agent]
        A2[Document]
        A3[Conversation]
    end
    
    subgraph Events
        E1[QuestionSubmitted]
        E2[DocumentUploaded]
        E3[SessionStarted]
        E4[SessionEnded]
    end
    
    C1 --> A1 --> E1
    C2 --> A2 --> E2
    C3 --> A3 --> E3
    C4 --> A3 --> E4
```

## 5. ãƒªãƒ¼ãƒ‰ãƒ¢ãƒ‡ãƒ«

| ãƒªãƒ¼ãƒ‰ãƒ¢ãƒ‡ãƒ« | ç”¨é€” | æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ |
|-------------|------|-------------|
| `ChatView` | ãƒãƒ£ãƒƒãƒˆUIè¡¨ç¤º | `MessageAdded` |
| `SearchResultView` | æ¤œç´¢çµæžœè¡¨ç¤º | `SearchExecuted` |
| `DocumentListView` | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§ | `IndexUpdated` |
| `AnalyticsDashboard` | åˆ†æžãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | å…¨ã‚¤ãƒ™ãƒ³ãƒˆ |
| `UsageMetrics` | ä½¿ç”¨é‡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | `ResponseGenerated` |

## 6. ãƒãƒªã‚·ãƒ¼ï¼ˆè‡ªå‹•å‡¦ç†ï¼‰

```python
# When DocumentUploaded -> Start Processing
@policy("document_processing")
async def on_document_uploaded(event: DocumentUploaded):
    await chunk_document(event.document_id)
    await generate_embeddings(event.document_id)
    await update_index(event.document_id)

# When QuestionSubmitted -> Execute RAG
@policy("rag_execution")
async def on_question_submitted(event: QuestionSubmitted):
    results = await search_knowledge_base(event.question)
    context = await assemble_context(results)
    response = await generate_response(event.question, context)
    await stream_response(event.session_id, response)

# When ResponseGenerated -> Log to BigQuery
@policy("analytics_logging")
async def on_response_generated(event: ResponseGenerated):
    await log_to_bigquery({
        "timestamp": event.timestamp,
        "tokens": event.response.tokens_used,
        "latency": event.response.latency_ms,
        "model": event.response.model
    })
```

